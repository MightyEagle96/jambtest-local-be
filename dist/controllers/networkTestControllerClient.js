'use strict';const a10_0x26d180=a10_0x40fc;(function(_0x15f127,_0x4ee5f7){const _0x1278d5=a10_0x40fc,_0x324c59=_0x15f127();while(!![]){try{const _0x9dee3e=-parseInt(_0x1278d5(0x148))/0x1+-parseInt(_0x1278d5(0x15a))/0x2+-parseInt(_0x1278d5(0x12e))/0x3*(parseInt(_0x1278d5(0x14f))/0x4)+parseInt(_0x1278d5(0x119))/0x5*(parseInt(_0x1278d5(0x11e))/0x6)+parseInt(_0x1278d5(0x146))/0x7+parseInt(_0x1278d5(0x120))/0x8+parseInt(_0x1278d5(0x143))/0x9;if(_0x9dee3e===_0x4ee5f7)break;else _0x324c59['push'](_0x324c59['shift']());}catch(_0x37064a){_0x324c59['push'](_0x324c59['shift']());}}}(a10_0x5132,0xdb269));var __awaiter=this&&this[a10_0x26d180(0x12f)]||function(_0x10536f,_0x75f44e,_0x2f6ddc,_0x5526ba){function _0xe5c2cc(_0x1bf411){return _0x1bf411 instanceof _0x2f6ddc?_0x1bf411:new _0x2f6ddc(function(_0x31a043){_0x31a043(_0x1bf411);});}return new(_0x2f6ddc||(_0x2f6ddc=Promise))(function(_0x41dbf1,_0x112d96){const _0x5b9fb7=a10_0x40fc;function _0x312fbc(_0x586be2){const _0x4d60b4=a10_0x40fc;try{_0x52c33d(_0x5526ba[_0x4d60b4(0x129)](_0x586be2));}catch(_0x915fa9){_0x112d96(_0x915fa9);}}function _0x3683b2(_0xc13181){try{_0x52c33d(_0x5526ba['throw'](_0xc13181));}catch(_0x1e2d66){_0x112d96(_0x1e2d66);}}function _0x52c33d(_0xf9c863){const _0x4e2517=a10_0x40fc;_0xf9c863[_0x4e2517(0x13d)]?_0x41dbf1(_0xf9c863['value']):_0xe5c2cc(_0xf9c863[_0x4e2517(0x153)])[_0x4e2517(0x13f)](_0x312fbc,_0x3683b2);}_0x52c33d((_0x5526ba=_0x5526ba[_0x5b9fb7(0x12c)](_0x10536f,_0x75f44e||[]))[_0x5b9fb7(0x129)]());});},__importDefault=this&&this[a10_0x26d180(0x116)]||function(_0x5ee77d){return _0x5ee77d&&_0x5ee77d['__esModule']?_0x5ee77d:{'default':_0x5ee77d};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a10_0x26d180(0x122)]=exports['endNetworkTest']=exports[a10_0x26d180(0x159)]=exports[a10_0x26d180(0x11a)]=exports[a10_0x26d180(0x132)]=exports[a10_0x26d180(0x152)]=exports['viewNetworkTest']=void 0x0;const networkTest_1=__importDefault(require('../models/networkTest')),computerModel_1=__importDefault(require(a10_0x26d180(0x140))),centreModel_1=__importDefault(require(a10_0x26d180(0x14c))),DataQueue_1=require('./DataQueue'),networkTestResponse_1=__importDefault(require(a10_0x26d180(0x124))),questions_1=__importDefault(require('./questions')),activeTestIntervals=new Map(),viewNetworkTest=(_0x77ca43,_0x16be22)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x262222=a10_0x26d180,_0xb72281=yield networkTest_1[_0x262222(0x151)][_0x262222(0x131)](_0x77ca43[_0x262222(0x149)]['id']);if(!_0xb72281)return _0x16be22[_0x262222(0x126)](0x190)[_0x262222(0x12a)](_0x262222(0x133));_0x16be22[_0x262222(0x12a)](_0xb72281);});function a10_0x40fc(_0x4c9c49,_0x1aa557){const _0x513239=a10_0x5132();return a10_0x40fc=function(_0x40fc10,_0x5ac45d){_0x40fc10=_0x40fc10-0x113;let _0x1ebe49=_0x513239[_0x40fc10];return _0x1ebe49;},a10_0x40fc(_0x4c9c49,_0x1aa557);}exports['viewNetworkTest']=viewNetworkTest;const errorMessages={'noCentre':'No\x20centre\x20found,\x20contact\x20administrator','noComputer':a10_0x26d180(0x158),'noActiveTest':a10_0x26d180(0x118),'computerFlagged':a10_0x26d180(0x12b),'notUploaded':a10_0x26d180(0x142),'alreadyTested':a10_0x26d180(0x14b)},networkTestValidation=(_0x2e119d,_0x2b5abc,_0x4b6a89)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x291938=a10_0x26d180;var _0x1271ce,_0x233148;const _0x44f5cf=yield centreModel_1[_0x291938(0x151)]['findOne'](),_0x2126f1=_0x2e119d['body'],_0x1691a2=(_0x1271ce=_0x2126f1['serialNumber'])===null||_0x1271ce===void 0x0?void 0x0:_0x1271ce['toLowerCase'](),_0x4f74ad=(_0x233148=_0x2126f1[_0x291938(0x13a)])===null||_0x233148===void 0x0?void 0x0:_0x233148[_0x291938(0x150)](),_0x508f2f=(_0x2126f1['macAddresses']||[])['map'](_0x461dd3=>_0x461dd3[_0x291938(0x150)]());if(!_0x44f5cf)return _0x2b5abc[_0x291938(0x126)](0x190)['send'](errorMessages['noCentre']);const _0x49261e=yield computerModel_1[_0x291938(0x151)][_0x291938(0x135)]({'$and':[{'serialNumber':_0x1691a2},{'processorId':_0x4f74ad},{'macAddresses':{'$in':_0x508f2f}}]});if(!_0x49261e)return _0x2b5abc[_0x291938(0x126)](0x190)[_0x291938(0x12a)](errorMessages[_0x291938(0x14d)]);if(_0x49261e[_0x291938(0x126)]!==_0x291938(0x14e))return _0x2b5abc[_0x291938(0x126)](0x190)[_0x291938(0x12a)](errorMessages[_0x291938(0x13b)]);if(_0x49261e['flagged'])return _0x2b5abc[_0x291938(0x126)](0x190)[_0x291938(0x12a)](errorMessages['computerFlagged']);const _0x1518f8=yield networkTest_1['default'][_0x291938(0x135)]({'active':!![]});if(!_0x1518f8)return _0x2b5abc[_0x291938(0x126)](0x190)['send'](errorMessages[_0x291938(0x117)]);if(_0x1518f8){const _0x4636b3=yield networkTestResponse_1[_0x291938(0x151)][_0x291938(0x135)]({'computer':_0x49261e[_0x291938(0x139)][_0x291938(0x123)](),'networkTest':_0x1518f8[_0x291938(0x139)][_0x291938(0x123)](),'status':_0x291938(0x15b)});if(_0x4636b3)return _0x2b5abc[_0x291938(0x126)](0x190)[_0x291938(0x12a)](errorMessages['alreadyTested']);}_0x2e119d[_0x291938(0x144)][_0x291938(0x113)]=_0x49261e[_0x291938(0x139)]['toString'](),_0x2e119d[_0x291938(0x144)][_0x291938(0x155)]=_0x1518f8[_0x291938(0x139)][_0x291938(0x123)](),_0x4b6a89();});exports[a10_0x26d180(0x152)]=networkTestValidation;function a10_0x5132(){const _0x4a4e07=['This\x20computer\x20is\x20not\x20yet\x20registered\x20on\x20the\x20JAMB\x20test\x20network','24495687AEjqhy','headers','No\x20matching\x20test\x20found\x20for:','6628321mnISSC','responses','1317893eVJChN','params','endNetworkTest','This\x20computer\x20has\x20already\x20been\x20tested','../models/centreModel','noComputer','uploaded','44ADRsXK','toLowerCase','default','networkTestValidation','value','duration','networktest','networkTest','Server\x20error','Computer\x20not\x20yet\x20registered','questionAndResponseCount','2684880BuJlAd','ended','Error\x20in\x20sendResponses:','computer','populate','ConcurrentJobQueue','__importDefault','noActiveTest','There\x20is\x20no\x20active\x20network\x20test','995qneSCP','sendResponses','Response\x20not\x20found','enqueue','maxResponses','9624WZewCe','create','9202608oEXfNC','all','viewMyComputerResponse','toString','../models/networkTestResponse','No\x20matching\x20test\x20found','status','log','floor','next','send','This\x20computer\x20has\x20been\x20flagged\x20for\x20an\x20infraction','apply','timeLeft','430962hNnhHg','__awaiter','save','findById','beginNetworkTest','Test\x20not\x20found','No\x20matching\x20response\x20found','findOne','endedAt','error','random','_id','processorId','notUploaded','body','done','assign','then','../models/computerModel','Success'];a10_0x5132=function(){return _0x4a4e07;};return a10_0x5132();}const dataQueue=new DataQueue_1[(a10_0x26d180(0x115))]({'concurrency':0x1,'maxQueueSize':0x64,'retries':0x0,'retryDelay':0xbb8,'shutdownTimeout':0x7530}),beginNetworkTest=(_0x1eb296,_0x5923d7)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x2564db=a10_0x26d180;_0x5923d7[_0x2564db(0x12a)]({'networkTest':_0x1eb296['headers']['networktest'],'computer':_0x1eb296[_0x2564db(0x144)][_0x2564db(0x113)]}),dataQueue[_0x2564db(0x11c)](()=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0xf55a4c=_0x2564db,_0x50198a=yield networkTest_1[_0xf55a4c(0x151)][_0xf55a4c(0x131)](_0x1eb296[_0xf55a4c(0x144)][_0xf55a4c(0x155)]),_0x492051=yield networkTestResponse_1[_0xf55a4c(0x151)][_0xf55a4c(0x135)]({'computer':_0x1eb296[_0xf55a4c(0x144)][_0xf55a4c(0x113)],'networkTest':_0x1eb296[_0xf55a4c(0x144)][_0xf55a4c(0x155)]});!_0x492051&&_0x50198a&&(yield networkTestResponse_1['default'][_0xf55a4c(0x11f)]({'computer':_0x1eb296[_0xf55a4c(0x144)][_0xf55a4c(0x113)],'networkTest':_0x1eb296[_0xf55a4c(0x144)]['networktest'],'ipAddress':_0x1eb296['ip'],'responses':0x0,'timeLeft':_0x50198a[_0xf55a4c(0x154)],'loggedInAt':new Date()}));}));});exports[a10_0x26d180(0x132)]=beginNetworkTest;const responseQueue=new DataQueue_1[(a10_0x26d180(0x115))]({'concurrency':0x1,'maxQueueSize':0x64,'retries':0x0,'retryDelay':0xbb8,'shutdownTimeout':0x7530}),sendResponses=(_0x403208,_0x1c9eb5)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0xb9d59a=a10_0x26d180;try{const _0x5c9d7f=yield networkTest_1['default'][_0xb9d59a(0x135)]({'active':!![]});if(!_0x5c9d7f)return _0x1c9eb5['sendStatus'](0x194);yield responseQueue[_0xb9d59a(0x11c)](()=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0xbef253=_0xb9d59a,{computer:_0x338436,networktest:_0x42c127,timeLeft:_0x22d972}=_0x403208[_0xbef253(0x13c)],_0x34362a=yield networkTest_1[_0xbef253(0x151)][_0xbef253(0x131)](_0x42c127);if(!_0x34362a)return console['log'](_0xbef253(0x145),_0x42c127),_0x1c9eb5[_0xbef253(0x126)](0x194)['send'](_0xbef253(0x125));const _0x2c9316=yield networkTestResponse_1[_0xbef253(0x151)][_0xbef253(0x135)]({'computer':_0x338436,'networkTest':_0x42c127});if(!_0x2c9316)return console[_0xbef253(0x127)]('No\x20matching\x20response\x20found\x20for:',{'computer':_0x338436,'networktest':_0x42c127}),_0x1c9eb5[_0xbef253(0x126)](0x194)[_0xbef253(0x12a)]({'message':_0xbef253(0x134)});_0x2c9316[_0xbef253(0x147)]+0x1<=_0x34362a[_0xbef253(0x11d)]&&(_0x2c9316[_0xbef253(0x147)]+=0x1),_0x2c9316[_0xbef253(0x12d)]=_0x22d972,_0x2c9316[_0xbef253(0x126)]='connected',yield _0x2c9316['save'](),_0x1c9eb5[_0xbef253(0x12a)](_0xbef253(0x141));}));}catch(_0x35546d){console[_0xb9d59a(0x137)](_0xb9d59a(0x15c),_0x35546d),_0x1c9eb5[_0xb9d59a(0x126)](0x1f4)['send']({'message':_0xb9d59a(0x157)});}});exports['sendResponses']=sendResponses;const questionAndResponseCount=(_0x479dd8,_0x155406)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x34c790=a10_0x26d180,[_0x371fc4,_0x65be8e]=yield Promise[_0x34c790(0x121)]([networkTestResponse_1[_0x34c790(0x151)]['findOne']({'computer':_0x479dd8[_0x34c790(0x13c)]['computer'],'networkTest':_0x479dd8['body'][_0x34c790(0x155)]}),networkTest_1[_0x34c790(0x151)][_0x34c790(0x131)](_0x479dd8[_0x34c790(0x13c)][_0x34c790(0x155)])]);if(!_0x371fc4)return _0x155406[_0x34c790(0x126)](0x194)[_0x34c790(0x12a)](_0x34c790(0x11b));if(!_0x65be8e)return _0x155406[_0x34c790(0x126)](0x194)[_0x34c790(0x12a)](_0x34c790(0x133));function _0x56f5db(){const _0x570fa2=_0x34c790,_0x2e57cc=Math[_0x570fa2(0x128)](Math[_0x570fa2(0x138)]()*questions_1[_0x570fa2(0x151)]['length']);return questions_1[_0x570fa2(0x151)][_0x2e57cc];}_0x155406[_0x34c790(0x12a)](Object[_0x34c790(0x13e)](Object[_0x34c790(0x13e)]({},_0x56f5db()),{'responses':_0x371fc4['responses'],'maxResponses':_0x65be8e[_0x34c790(0x11d)]}));});exports[a10_0x26d180(0x159)]=questionAndResponseCount;const endQueue=new DataQueue_1[(a10_0x26d180(0x115))]({'concurrency':0x1,'maxQueueSize':0x64,'retries':0x0,'retryDelay':0xbb8,'shutdownTimeout':0x7530}),endNetworkTest=(_0x66b7b4,_0x15b008)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x474915=a10_0x26d180;endQueue[_0x474915(0x11c)](()=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x4c6775=_0x474915,_0x42b557=yield networkTestResponse_1[_0x4c6775(0x151)]['findOne']({'computer':_0x66b7b4[_0x4c6775(0x13c)][_0x4c6775(0x113)],'networkTest':_0x66b7b4['body'][_0x4c6775(0x155)]});_0x42b557&&(_0x42b557[_0x4c6775(0x12d)]=0x0,_0x42b557[_0x4c6775(0x136)]=new Date(),_0x42b557['status']='ended',yield _0x42b557[_0x4c6775(0x130)]());})),_0x15b008[_0x474915(0x12a)](_0x474915(0x141));});exports[a10_0x26d180(0x14a)]=endNetworkTest;const viewMyComputerResponse=(_0x51e956,_0x1a4b25)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x4a813d=a10_0x26d180,_0xaa182=yield networkTestResponse_1[_0x4a813d(0x151)]['findOne']({'computer':_0x51e956[_0x4a813d(0x144)][_0x4a813d(0x113)],'networkTest':_0x51e956[_0x4a813d(0x144)][_0x4a813d(0x155)]})[_0x4a813d(0x114)]([_0x4a813d(0x156),'computer']);if(!_0xaa182)return _0x1a4b25[_0x4a813d(0x126)](0x194)[_0x4a813d(0x12a)](_0x4a813d(0x11b));_0x1a4b25[_0x4a813d(0x12a)](_0xaa182);});exports[a10_0x26d180(0x122)]=viewMyComputerResponse;