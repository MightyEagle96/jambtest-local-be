'use strict';const a12_0x149fa1=a12_0x37be;(function(_0x1463cf,_0x43e96e){const _0x28b656=a12_0x37be,_0x44e452=_0x1463cf();while(!![]){try{const _0x442478=parseInt(_0x28b656(0x15d))/0x1+-parseInt(_0x28b656(0x14d))/0x2+parseInt(_0x28b656(0x131))/0x3*(-parseInt(_0x28b656(0x146))/0x4)+-parseInt(_0x28b656(0x13a))/0x5*(-parseInt(_0x28b656(0x144))/0x6)+parseInt(_0x28b656(0x168))/0x7+-parseInt(_0x28b656(0x154))/0x8*(parseInt(_0x28b656(0x163))/0x9)+parseInt(_0x28b656(0x151))/0xa;if(_0x442478===_0x43e96e)break;else _0x44e452['push'](_0x44e452['shift']());}catch(_0x439a23){_0x44e452['push'](_0x44e452['shift']());}}}(a12_0x1b0d,0x85fef));var __awaiter=this&&this[a12_0x149fa1(0x15f)]||function(_0x5a2b06,_0x25a442,_0x2cf9b7,_0x5a42f1){function _0x3958ba(_0x57edef){return _0x57edef instanceof _0x2cf9b7?_0x57edef:new _0x2cf9b7(function(_0x3ea34c){_0x3ea34c(_0x57edef);});}return new(_0x2cf9b7||(_0x2cf9b7=Promise))(function(_0x472b0f,_0x401314){function _0x1d13ab(_0x15d01d){const _0xd690bc=a12_0x37be;try{_0x24b8f0(_0x5a42f1[_0xd690bc(0x165)](_0x15d01d));}catch(_0x20fb63){_0x401314(_0x20fb63);}}function _0x249671(_0x4bc871){const _0x548fd3=a12_0x37be;try{_0x24b8f0(_0x5a42f1[_0x548fd3(0x124)](_0x4bc871));}catch(_0x3e9f07){_0x401314(_0x3e9f07);}}function _0x24b8f0(_0xab7d51){const _0xa73e86=a12_0x37be;_0xab7d51[_0xa73e86(0x137)]?_0x472b0f(_0xab7d51['value']):_0x3958ba(_0xab7d51['value'])[_0xa73e86(0x14a)](_0x1d13ab,_0x249671);}_0x24b8f0((_0x5a42f1=_0x5a42f1['apply'](_0x5a2b06,_0x25a442||[]))['next']());});},__importDefault=this&&this[a12_0x149fa1(0x166)]||function(_0x58bb47){const _0x5dea28=a12_0x149fa1;return _0x58bb47&&_0x58bb47[_0x5dea28(0x16e)]?_0x58bb47:{'default':_0x58bb47};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[a12_0x149fa1(0x153)]=exports[a12_0x149fa1(0x13f)]=exports[a12_0x149fa1(0x139)]=exports[a12_0x149fa1(0x142)]=exports['beginNetworkTest']=exports[a12_0x149fa1(0x12e)]=exports[a12_0x149fa1(0x16a)]=void 0x0;const networkTest_1=__importDefault(require(a12_0x149fa1(0x133))),computerModel_1=__importDefault(require(a12_0x149fa1(0x134))),centreModel_1=__importDefault(require(a12_0x149fa1(0x12c))),DataQueue_1=require(a12_0x149fa1(0x13d)),networkTestResponse_1=__importDefault(require('../models/networkTestResponse')),questions_1=__importDefault(require(a12_0x149fa1(0x14c))),activeTestIntervals=new Map(),viewNetworkTest=(_0x2e76ba,_0x4e1eff)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x4edd6a=a12_0x149fa1,_0x17d239=yield networkTest_1[_0x4edd6a(0x125)][_0x4edd6a(0x123)](_0x2e76ba[_0x4edd6a(0x15b)]['id']);if(!_0x17d239)return _0x4e1eff[_0x4edd6a(0x170)](0x190)[_0x4edd6a(0x141)](_0x4edd6a(0x128));_0x4e1eff['send'](_0x17d239);});exports[a12_0x149fa1(0x16a)]=viewNetworkTest;const errorMessages={'noCentre':'No\x20centre\x20found,\x20contact\x20administrator','noComputer':a12_0x149fa1(0x132),'noActiveTest':a12_0x149fa1(0x157),'computerFlagged':a12_0x149fa1(0x12b),'notUploaded':a12_0x149fa1(0x156),'alreadyTested':'This\x20computer\x20has\x20already\x20been\x20tested'},networkTestValidation=(_0x5907ee,_0x575057,_0xd990dc)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x2b1ed2=a12_0x149fa1;var _0x95229f,_0x303c1f;const _0x5c06a1=yield centreModel_1[_0x2b1ed2(0x125)][_0x2b1ed2(0x126)](),_0x4cd061=_0x5907ee[_0x2b1ed2(0x15c)],_0x184608=(_0x95229f=_0x4cd061[_0x2b1ed2(0x172)])===null||_0x95229f===void 0x0?void 0x0:_0x95229f[_0x2b1ed2(0x12f)](),_0x121c05=(_0x303c1f=_0x4cd061[_0x2b1ed2(0x12d)])===null||_0x303c1f===void 0x0?void 0x0:_0x303c1f[_0x2b1ed2(0x12f)](),_0x433451=(_0x4cd061[_0x2b1ed2(0x12a)]||[])['map'](_0x15ff18=>_0x15ff18[_0x2b1ed2(0x12f)]());if(!_0x5c06a1)return _0x575057['status'](0x190)[_0x2b1ed2(0x141)](errorMessages[_0x2b1ed2(0x136)]);const _0x3bccc6=yield computerModel_1[_0x2b1ed2(0x125)][_0x2b1ed2(0x126)]({'$and':[{'serialNumber':_0x184608},{'processorId':_0x121c05},{'macAddresses':{'$in':_0x433451}}]});if(!_0x3bccc6)return _0x575057[_0x2b1ed2(0x170)](0x190)[_0x2b1ed2(0x141)](errorMessages[_0x2b1ed2(0x14e)]);if(_0x3bccc6[_0x2b1ed2(0x170)]!=='uploaded')return _0x575057['status'](0x190)['send'](errorMessages[_0x2b1ed2(0x159)]);if(_0x3bccc6[_0x2b1ed2(0x161)])return _0x575057[_0x2b1ed2(0x170)](0x190)[_0x2b1ed2(0x141)](errorMessages['computerFlagged']);const _0x441bf0=yield networkTest_1[_0x2b1ed2(0x125)][_0x2b1ed2(0x126)]({'active':!![]});if(!_0x441bf0)return _0x575057['status'](0x190)[_0x2b1ed2(0x141)](errorMessages[_0x2b1ed2(0x14b)]);if(_0x441bf0){const _0x3370fc=yield networkTestResponse_1[_0x2b1ed2(0x125)][_0x2b1ed2(0x126)]({'computer':_0x3bccc6[_0x2b1ed2(0x143)][_0x2b1ed2(0x169)](),'networkTest':_0x441bf0[_0x2b1ed2(0x143)][_0x2b1ed2(0x169)](),'status':_0x2b1ed2(0x15e)});if(_0x3370fc)return _0x575057[_0x2b1ed2(0x170)](0x190)['send'](errorMessages[_0x2b1ed2(0x155)]);}_0x5907ee[_0x2b1ed2(0x140)][_0x2b1ed2(0x160)]=_0x3bccc6['_id'][_0x2b1ed2(0x169)](),_0x5907ee[_0x2b1ed2(0x140)][_0x2b1ed2(0x149)]=_0x441bf0[_0x2b1ed2(0x143)][_0x2b1ed2(0x169)](),_0xd990dc();});exports[a12_0x149fa1(0x12e)]=networkTestValidation;const dataQueue=new DataQueue_1[(a12_0x149fa1(0x164))]({'concurrency':0x1,'maxQueueSize':0x64,'retries':0x0,'retryDelay':0xbb8,'shutdownTimeout':0x7530}),beginNetworkTest=(_0x409e48,_0x577191)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x4fb8ea=a12_0x149fa1;_0x577191[_0x4fb8ea(0x141)]({'networkTest':_0x409e48[_0x4fb8ea(0x140)][_0x4fb8ea(0x149)],'computer':_0x409e48[_0x4fb8ea(0x140)][_0x4fb8ea(0x160)]}),dataQueue[_0x4fb8ea(0x171)](()=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x3cfbac=_0x4fb8ea,_0x330c2a=yield networkTest_1['default'][_0x3cfbac(0x123)](_0x409e48[_0x3cfbac(0x140)]['networktest']),_0x4977b9=yield networkTestResponse_1['default'][_0x3cfbac(0x126)]({'computer':_0x409e48[_0x3cfbac(0x140)]['computer'],'networkTest':_0x409e48[_0x3cfbac(0x140)][_0x3cfbac(0x149)]});!_0x4977b9&&_0x330c2a&&(yield networkTestResponse_1['default'][_0x3cfbac(0x129)]({'computer':_0x409e48[_0x3cfbac(0x140)][_0x3cfbac(0x160)],'networkTest':_0x409e48[_0x3cfbac(0x140)][_0x3cfbac(0x149)],'ipAddress':_0x409e48['ip'],'responses':0x0,'timeLeft':_0x330c2a[_0x3cfbac(0x13b)],'loggedInAt':new Date()}));}));});function a12_0x37be(_0x4f0c52,_0x3ff8f1){const _0x1b0d8f=a12_0x1b0d();return a12_0x37be=function(_0x37be88,_0x428eba){_0x37be88=_0x37be88-0x123;let _0x4c3717=_0x1b0d8f[_0x37be88];return _0x4c3717;},a12_0x37be(_0x4f0c52,_0x3ff8f1);}exports[a12_0x149fa1(0x130)]=beginNetworkTest;const responseQueue=new DataQueue_1[(a12_0x149fa1(0x164))]({'concurrency':0x1,'maxQueueSize':0x64,'retries':0x0,'retryDelay':0xbb8,'shutdownTimeout':0x7530}),sendResponses=(_0x558fad,_0x56cca7)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x30bb8f=a12_0x149fa1;try{const _0x3b2db8=yield networkTest_1[_0x30bb8f(0x125)][_0x30bb8f(0x126)]({'active':!![]});if(!_0x3b2db8)return _0x56cca7['sendStatus'](0x194);yield responseQueue['enqueue'](()=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x50c3e3=_0x30bb8f,{computer:_0x1780a3,networktest:_0x8df054,timeLeft:_0x481550}=_0x558fad[_0x50c3e3(0x15c)],_0x57365e=yield networkTest_1[_0x50c3e3(0x125)][_0x50c3e3(0x123)](_0x8df054);if(!_0x57365e)return console[_0x50c3e3(0x145)](_0x50c3e3(0x158),_0x8df054),_0x56cca7[_0x50c3e3(0x170)](0x194)[_0x50c3e3(0x141)](_0x50c3e3(0x148));const _0xbf0404=yield networkTestResponse_1[_0x50c3e3(0x125)][_0x50c3e3(0x126)]({'computer':_0x1780a3,'networkTest':_0x8df054});if(!_0xbf0404)return _0x56cca7[_0x50c3e3(0x170)](0x194)[_0x50c3e3(0x141)]({'message':'No\x20matching\x20response\x20found'});_0xbf0404[_0x50c3e3(0x16c)]+0x1<=_0x57365e[_0x50c3e3(0x138)]&&(_0xbf0404[_0x50c3e3(0x16c)]+=0x1),_0xbf0404[_0x50c3e3(0x162)]=_0x481550,_0xbf0404[_0x50c3e3(0x170)]='connected',yield _0xbf0404[_0x50c3e3(0x167)](),_0x56cca7[_0x50c3e3(0x141)](_0x50c3e3(0x16d));}));}catch(_0x28c817){console[_0x30bb8f(0x14f)](_0x30bb8f(0x16f),_0x28c817),_0x56cca7[_0x30bb8f(0x170)](0x1f4)[_0x30bb8f(0x141)]({'message':_0x30bb8f(0x150)});}});exports[a12_0x149fa1(0x142)]=sendResponses;const questionAndResponseCount=(_0x5d78b1,_0x3ebee1)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x7c8ebc=a12_0x149fa1,[_0x1f1e86,_0x14d851]=yield Promise[_0x7c8ebc(0x147)]([networkTestResponse_1[_0x7c8ebc(0x125)]['findOne']({'computer':_0x5d78b1[_0x7c8ebc(0x15c)][_0x7c8ebc(0x160)],'networkTest':_0x5d78b1[_0x7c8ebc(0x15c)][_0x7c8ebc(0x149)]}),networkTest_1[_0x7c8ebc(0x125)]['findById'](_0x5d78b1[_0x7c8ebc(0x15c)][_0x7c8ebc(0x149)])]);if(!_0x1f1e86)return _0x3ebee1[_0x7c8ebc(0x170)](0x194)[_0x7c8ebc(0x141)](_0x7c8ebc(0x13c));if(!_0x14d851)return _0x3ebee1[_0x7c8ebc(0x170)](0x194)[_0x7c8ebc(0x141)](_0x7c8ebc(0x128));function _0x7f68a(){const _0x354f02=_0x7c8ebc,_0x297771=Math[_0x354f02(0x152)](Math['random']()*questions_1[_0x354f02(0x125)][_0x354f02(0x135)]);return questions_1[_0x354f02(0x125)][_0x297771];}_0x3ebee1[_0x7c8ebc(0x141)](Object['assign'](Object[_0x7c8ebc(0x15a)]({},_0x7f68a()),{'responses':_0x1f1e86[_0x7c8ebc(0x16c)],'maxResponses':_0x14d851['maxResponses']}));});exports[a12_0x149fa1(0x139)]=questionAndResponseCount;const endQueue=new DataQueue_1[(a12_0x149fa1(0x164))]({'concurrency':0x1,'maxQueueSize':0x64,'retries':0x0,'retryDelay':0xbb8,'shutdownTimeout':0x7530}),endNetworkTest=(_0x265e0d,_0x78f0dd)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x47cb30=a12_0x149fa1,_0x3d4654=yield networkTest_1[_0x47cb30(0x125)]['findOne']({'active':!![]});if(!_0x3d4654)return _0x78f0dd[_0x47cb30(0x13e)](0x194);endQueue[_0x47cb30(0x171)](()=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x29e3f9=_0x47cb30,{computer:_0x1fc585,networktest:_0x28418f}=_0x265e0d[_0x29e3f9(0x15c)],_0x472bb7=yield networkTest_1[_0x29e3f9(0x125)][_0x29e3f9(0x123)](_0x28418f);if(!_0x472bb7)return console[_0x29e3f9(0x145)](_0x29e3f9(0x158),_0x28418f),_0x78f0dd['sendStatus'](0x194);const _0x1c7096=yield networkTestResponse_1[_0x29e3f9(0x125)]['findOne']({'computer':_0x1fc585,'networkTest':_0x28418f});if(!_0x1c7096)return _0x78f0dd[_0x29e3f9(0x13e)](0x194);_0x1c7096[_0x29e3f9(0x16c)]+0x1<=_0x472bb7[_0x29e3f9(0x138)]&&(_0x1c7096[_0x29e3f9(0x16c)]+=0x1),_0x1c7096['timeLeft']=0x0,_0x1c7096[_0x29e3f9(0x170)]=_0x29e3f9(0x15e),yield _0x1c7096[_0x29e3f9(0x167)](),_0x78f0dd[_0x29e3f9(0x141)](_0x29e3f9(0x16d));}));});exports['endNetworkTest']=endNetworkTest;function a12_0x1b0d(){const _0x410079=['create','macAddresses','This\x20computer\x20has\x20been\x20flagged\x20for\x20an\x20infraction','../models/centreModel','processorId','networkTestValidation','toLowerCase','beginNetworkTest','48039YbgIoK','Computer\x20not\x20yet\x20registered','../models/networkTest','../models/computerModel','length','noCentre','done','maxResponses','questionAndResponseCount','20sILRtG','duration','Response\x20not\x20found','./DataQueue','sendStatus','endNetworkTest','headers','send','sendResponses','_id','1016184BuCtrB','log','108Hyxrpm','all','No\x20matching\x20test\x20found','networktest','then','noActiveTest','./questions','1969952lksZdK','noComputer','error','Server\x20error','12542390fcZEyP','floor','viewMyComputerResponse','2708768tbtriw','alreadyTested','This\x20computer\x20is\x20not\x20yet\x20registered\x20on\x20the\x20JAMB\x20test\x20network','There\x20is\x20no\x20active\x20network\x20test','No\x20matching\x20test\x20found\x20for:','notUploaded','assign','params','body','309677nUMoLE','ended','__awaiter','computer','flagged','timeLeft','18zXkyMa','ConcurrentJobQueue','next','__importDefault','save','2813958ZlQYKA','toString','viewNetworkTest','populate','responses','Success','__esModule','Error\x20in\x20sendResponses:','status','enqueue','serialNumber','findById','throw','default','findOne','networkTest','Test\x20not\x20found'];a12_0x1b0d=function(){return _0x410079;};return a12_0x1b0d();}const viewMyComputerResponse=(_0x4f3979,_0x340311)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x197fd7=a12_0x149fa1,_0x353957=yield networkTestResponse_1[_0x197fd7(0x125)]['findOne']({'computer':_0x4f3979['headers'][_0x197fd7(0x160)],'networkTest':_0x4f3979[_0x197fd7(0x140)]['networktest']})[_0x197fd7(0x16b)]([_0x197fd7(0x127),'computer']);if(!_0x353957)return _0x340311[_0x197fd7(0x170)](0x194)[_0x197fd7(0x141)]('Response\x20not\x20found');_0x340311[_0x197fd7(0x141)](_0x353957);});exports[a12_0x149fa1(0x153)]=viewMyComputerResponse;